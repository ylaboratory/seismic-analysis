# Data cleaning scripts
This folder contains scripts for preparing the expression data sets from raw data downloaded directly from the respective sources. The scripts are organized as follows:

- `Saunders_data_cleaning.R` Script for cleaning the [raw data](http://dropviz.org/) from Saunders et al. (2018) and preparing the expression data for the analysis. All cells that are labelled as singleton, doublet, outliers are filtered. The subcluster annotated is mannually curated based on the original names to remove typos and inconsistencies, which is used for the fine_cluster grabularity. The cluster labels are extract from the supplementary file of the original paper. The neuron subclass labels are annotated based on the primary neurotransmitter type.

- `Tabula_muris_data_cleaning.R` Script for cleaning the [raw data](https://figshare.com/projects/Tabula_Muris_Transcriptomic_characterization_of_20_organs_and_tissues_from_Mus_musculus_at_single_cell_resolution/27733) from Tabula Muris Consortium (2018) and preparing the expression data for the analysis. The data is downloaded from the figshare repository and the expression data is extracted from the Seurat object.

- `Tabula_sapiens_data_cleaning.R` Script for cleaning the [raw data](https://figshare.com/projects/Tabula_Sapiens/100973) from Tabula Sapiens Consortium (2022). The original cell metadata do not contain information about the cell ontology id but only the cell ontology class. To map the cell ontology class to the cell ontology id, ensuring the cell types are precisely annotated, we reversely annotate the cell ontology id using [the whole cell ontology mapping file](https://obofoundry.org/ontology/cl.html) (with `Tabula_sapiens_ontology_cleaning.py`). The expression data is extracted from the Seurat object.

- `Tabula_sapiens_ontology_cleaning.py` Script for cleaning the cell ontology class to cell ontology id mapping for the Tabula Sapiens data set. The original cell metadata do not contain information about the cell ontology id but only the cell ontology class. To map the cell ontology class to the cell ontology id, ensuring the cell types are precisely annotated, we reversely annotate the cell ontology id using [the whole cell ontology mapping file](https://obofoundry.org/ontology/cl.html). The script is written in Python and uses the `pandas` library for data manipulation. Any annotation that cannot be mapped to the cell ontology id is mannually curated based on the original names to remove typos and inconsistencies.

- `gwas_processing.R` Script for processing all the GWAS summary statistics to MAGMA gene-level z-scores. The GWAS summary statistics are downloaded from the respective data source as shown in the supplementary file mentioned and the MAGMA gene-level z-scores are calculated using the MAGMA software. The MAGMA gene-level z-scores are used for the trait-associated cell type enrichment analysis. The .tsv files are saved in the `data/gwas` directory for scDRS analysis.

- `sim_data_processing.R` Script for generating the random seeds for the null simulation and causal simulation. Three sets of random data are generated: the shuffled expression data, the shuffle (or not) gene sets, and the radom seed sample for a random cells. 10 random traits are sampled to generate a set of random MAGMA gene-level z-scores for the null simulation. The subsampled and shuffled expression data are then saved in the `data/expr` directory for the null simulation and causal simulation. The random seed sample is saved in the `data/sim` directory for the null simulation.

- `runtime_data_processing.R` Script for generating the runtime data for the runtime evaluation. Expression datasets with different sizes are sampled for later evaluation of data for the frameworks. The script schedules all the tasks using podman and measures the execution time for each framework. The runtime data is saved in the `data/runtime` directory for the runtime evaluation.